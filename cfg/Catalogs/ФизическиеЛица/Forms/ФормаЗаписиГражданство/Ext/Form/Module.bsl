////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

Процедура ПриОткрытии()
	
	Если НаборЗаписей.Количество() = 0 тогда
		НаборЗаписей.Добавить();
		ЗаписьИзНабора = НаборЗаписей[0];
	КонецЕсли;
	ЗаписьИзНабора 						= НаборЗаписей[0];
	Период 								= ?(НЕ ЗначениеЗаполнено(ЗаписьИзНабора.Период), '19000101', ЗаписьИзНабора.Период);;
	НеИмеетПравоНаПенсию 				= ЗаписьИзНабора.НеИмеетПравоНаПенсию;
	НеЯвляетсяНалоговымРезидентом 	= ЗаписьИзНабора.НеЯвляетсяНалоговымРезидентом;
	Страна 								= ЗаписьИзНабора.Страна;
	ФизЛицо								= ЗаписьИзНабора.Физлицо;
	
	Если ФизЛицо.Пустая() тогда
		ИндКнопки = ЭлементыФормы.ОсновныеДействияФормы.Кнопки.Индекс(ЭлементыФормы.ОсновныеДействияФормы.Кнопки.КнопкаИстория);
		ЭлементыФормы.ОсновныеДействияФормы.Кнопки.Удалить(ИндКнопки);
		
		ИндКнопки = ЭлементыФормы.ОсновныеДействияФормы.Кнопки.Индекс(ЭлементыФормы.ОсновныеДействияФормы.Кнопки.РазделительИстория);
		ЭлементыФормы.ОсновныеДействияФормы.Кнопки.Удалить(ИндКнопки);
	КонецЕсли;
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ФОРМЫ

Процедура ПодтвердитьИзменения(Кнопка)

	ЗаписьИзНабора = НаборЗаписей[0];
	Если НеИмеетПравоНаПенсиюПриОткрытии <> НеИмеетПравоНаПенсию ИЛИ
		НеЯвляетсяНалоговымРезидентомПриОткрытии <> НеЯвляетсяНалоговымРезидентом ИЛИ
		СтранаПриОткрытии <> Страна ИЛИ
		ПериодПриОткрытии <> Период Тогда
	
		ЗаписьИзНабора.Период   						= Период;
		ЗаписьИзНабора.НеИмеетПравоНаПенсию  		   	= НеИмеетПравоНаПенсию;
		ЗаписьИзНабора.НеЯвляетсяНалоговымРезидентом 	= НеЯвляетсяНалоговымРезидентом;
		ЗаписьИзНабора.Страна						   	= Страна;
	КонецЕсли;
	Закрыть();
	Оповестить("ОбновитьФорму", Новый Структура("ИмяЭлемента","Гражданство"), Справочники.ФизическиеЛица.ПустаяСсылка());
	
КонецПроцедуры

Процедура КнопкаИсторияНажатие(Элемент)
	
	ФормаРегистра = РегистрыСведений.ГражданствоФизЛиц.ПолучитьФормуСписка();
	ФормаРегистра.РегистрСведенийСписок.Отбор.ФизЛицо.Значение 					 = ФизЛицо;
	ФормаРегистра.РегистрСведенийСписок.Отбор.ФизЛицо.ВидСравнения 				 = ВидСравнения.Равно;
	ФормаРегистра.РегистрСведенийСписок.Отбор.ФизЛицо.Использование 			 = Истина;
	ФормаРегистра.ЭлементыФормы.РегистрСведенийСписок.НачальноеОтображениеСписка = НачальноеОтображениеСписка.Конец;
	
	ФормаРегистра.Открыть();
	
КонецПроцедуры
